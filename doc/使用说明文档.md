# WDT 帮助文档

## WDT使用案例

- 接收端： `wdt.exe -directory RECEIVE_DIR -run_as_daemon=true -ipv4`
- 发送端： `wdt.exe -directory SEND_DATA_DIR -destination REVEIVER_IP -transfer_id xxxxxxxx`
  - `SEND_DATA_DIR` 目录下包含一次测试需要传输的数据
  - `transfer_id` 后参数由接收端命令生成


## WDT命令行所支持的参数选项
wdt: WDT Warp-speed Data Transfer. v 1.26.1603040 p 26.

### WDT命令行选项
#### wdtCmdLine.cpp部分
 - ***`-abort_after_seconds` \[`int32`, Default: `0`\]*** (给定时间后退出传送，0表示不退出)
 - (Abort transfer after given seconds. 0 means don't abort.)
 - ***`-app_name` \[`string`, Default: `wdt`\]*** (应用运行标识)
 - (Identifier used for reporting (scuba, at fb))
 - ***`-connection_url` \[`string`, Default: `""`\]*** (接收端生成的连接地址（包含`transfer_id`以及其他参数），使用ssh时不推荐使用本参数，可使用`-`命令行参数作为替换保证密钥传输的安全性)
 - (Provide the connection string to connect to receiver (incl. transfer_id and other parameters). Deprecated: use - arg instead for safe encryption key transmission)
 - ***`-destination` \[`string`, Default: `""`\]*** (为空表示服务端模式，非空时用于指定目标主机)
 - (empty is server (destination) mode, non empty is destination host)
 - ***`-directory` \[`string`, Default: `""`\]*** (数据源/数据目的 目录)
 - (Source/Destination directory)
 - ***`-exit_on_bad_flags` \[`bool`, Default: `true`\]*** (若为`true`，给定错误或未识别的flag时，wdt立即退出；若为false，wdt将会忽略未知的flags)
 - (If true, wdt exits on bad/unknown flag. Otherwise, an unknown flags are ignored)
 - ***`-fork` \[`bool`, Default: `false`\]*** (若为`true`，wdt会生成一个receiver进程)
 - (If true, forks the receiver, if false, no forking/stay in fg)
 - ***`-manifest` \[`string`, Default: `""`\]*** (用于发送端，当指定`manifest`文件时，该文件中列出所有需要传送的文件，及文件大小（可选）；若值为`-`，表示从`stdin`读取文件列表信息；manifest每行代表一个待传送文件，每行最多两个以空格分隔的字段，第一个字段为文件名，第二字段代表文件大小（可选）)
 - (If specified, then we will read a list of files and optional sizes from this file, use - for stdin)
 - ***`-parse_transfer_log` \[`bool`, Default: `false`\]*** (是否开启日志解析与修复功能)
 - (If true, transfer log is parsed and fixed)
 - ***`-print_options` \[`bool`, Default: `false`\]*** (若为`true`，则打印选项参数值并退出wdt。其中打印的选项值包括wdt自身以及其他一些给定的命令行`flag`)
 - (If true, wdt prints the option values and exits. Option values printed take into account option type and other command line flags specified.)
 - ***`-protocol_version` \[`int32`, Default: `0`\]*** (协议版本号，主要用于模拟协议协商)
 - (Protocol version to use, this is used to simulate protocol negotiation)
 - ***`-recovery_id` \[`string`, Default: `""`\]*** (用于下载续传的恢复id号)
 - (Recovery-id to use for download resumption)
 - ***`-run_as_daemon` \[`bool`, Default: `false`\]*** (是否作为daemon程序运行，若为`true`，则receiver不会退出并一直运行)
 - (If true, run the receiver as never ending process)
 - ***`-test_only_encryption_secret` \[`string`, Default: `""`\]*** (仅用于测试，测试url编解码???)
 - (Test only encryption secret, to test url encoding/decoding)
 - ***`-transfer_id` \[`string`, Default: `""`\]*** (传输`id`号，数据接收端在启动时会长生一个传输`id`号，用于接收端发送数据时指定传输目标`id`)
 - (Transfer id. Receiver will generate one to be used (via URL) on the sender if not set explicitly)
 - ***`-treat_fewer_port_as_error` \[`bool`, Default: `false`\]*** (当接收端无法绑定所有wdt所需端口时，是否将该情况作为错误处理而终止`wdt`程序)
 - (If the receiver is unable to bind to all the ports, treat that as an error.)

#### util/WdtFlags.cpp部分
 - ***`-option_type` \[`string`, Default: `flash`\]***
 - (WDT option type. Options are initialized to different values depending on the type. Individual options can still be changed using specific flags. Use -print_options to see values)

#### util/WdtFlags.cpp.inc部分
 - ***`-abort_check_interval_millis` \[`int32`, Default: `200`\]*** (网络i/o期间检查是否终止的时间间隔，单位为毫秒)
 - (Interval in ms between checking for abort during network i/o, a negative value or 0 disables abort check)
 - ***`-accept_timeout_millis` \[`int32`, Default: `100`\]*** (wdt接收端接受请求的最大等待时延)
 - (accept timeout for wdt receiver in milliseconds)
 - ***`-accept_window_millis` \[`int32`, Default: `2000`\]*** (接受时延窗口，单位为毫秒。对于一次会话，在第一次连接被接收以后，其他连接必须要在接受时延窗口内到达)
 - (accept window size in milliseconds. For a session, after the first connection is received, other connections must be received within this duration)
 - ***`-avg_mbytes_per_sec` \[`double`, Default: `-1`\]*** (应该维持的目标传输速率，负值表示不设上限)
 - (Target transfer rate in Mbytes/sec that should be maintained, specify negative for unlimited)
 - ***`-backlog` \[`int32`, Default: `1`\]*** （接受backlog）
 - (Accept backlog)
 - ***`-block_size_mbytes` \[`double`, Default: `16`\]*** (文件传送数据块大小，负值表示文件传送时取消分块)
 - (Size of the blocks that files will be divided in, specify negative to disable the file splitting mode)
 - ***`-buffer_size` \[`int32`, Default: `262144`\]*** (每线程/套接字连接的缓存大小)
 - (Buffer size (per thread/socket))
 - ***`-connect_timeout_millis` \[`int32`, Default: `1000`\]*** (套接字连接最大超时，单位为毫秒)
 - (socket connect timeout in milliseconds)
 - ***`-delete_extra_files` \[`bool`, Default: `false`\]*** (恢复数据传输时，删除接收端的额外文件)
 - (If true, extra files on the receiver side is deleted during resumption)
 - ***`-disable_preallocation` \[`bool`, Default: `false`\]*** (取消通过`posix_fallocate`预分配文件)
 - (If true, files are not pre-allocated using posix_fallocate)
 - ***`-disable_sender_verification_during_resumption` \[`bool`, Default: `false`\]*** (取消发送端ip与传送日志中发送端ip的比较验证。当文件可以从不同的主机中下载时，该机制非常有用)
 - (If true, sender-ip is not verified with the ip in transfer log. This is useful if files can be downloaded from different hosts)
 - ***`-disk_sync_interval_mb` \[`double`, Default: `0.5`\]*** (磁盘同步间隔，单位为mb。负值表示取消同步)
 - (Disk sync interval in mb. A negative value disables syncing)
 - ***`-drain_extra_ms` \[`int32`, Default: `500`\]*** (发送端等待接收端完成缓冲区数据处理的额外时间缓冲量)
 - (Extra time buffer to account for network when sender waits for receiver to finish processing buffered data)
 - ***`-enable_checksum` \[`bool`, Default: `false`\]*** (是否开启数据传送时对数据块进行校验)
 - (If true, blocks are checksummed during transfer, redundant with gcm)
 - ***`-enable_download_resumption` \[`bool`, Default: `false`\]*** (若为`true`，wdt则支持对`append-only`文件的下载续传)
 - (If true, wdt supports download resumption for append-only files)
 - ***`-enable_perf_stat_collection` \[`bool`, Default: `false`\]*** (若为`true`，wdt会在数据传输结束时收集并汇报性能统计)
 - (If true, perf stats are collected and reported at the end of transfer)
 - ***`-encryption_type` \[`string`, Default: `"aes128gcm"`\]*** (加密方式，WDT目前支持`aes128ctr`（最快但没有完整性校验）以及`aes128gcm`（推荐及默认方式）。若未设置该值，传输过程中数据不加密（速度最快但不安全）)
 - (Encryption type to use. WDT currently supports aes128ctr (fastest but no integrity check) and aes128gcm (recommended, default). A value of none disables encryption (fastest but insecure))
 - ***`-exclude_regex` \[`string`, Default: `""`\]*** (表示哪些文件不被传送的正则表达式，空/默认值表示不排除任何文件，即所有文件都会被传输。)
 - (Regular expression representing files to exclude for transfer, empty/default is to not exclude any file.)
 - ***`-follow_symlinks` \[`bool`, Default: `false`\]*** (若为`true`，软连接文件会以所指向的文件的内容被传送)
 - (If true, follow symlinks and copy them as well)
 - ***`-full_reporting` \[`bool`, Default: `false`\]*** (若为`true`，则记录所有文件的传送状态，即传送成功的文件也会包含在报告中)
 - (If true, transfer stats for successfully transferred files are included in the report)
 - ***`-global_receiver_limit` \[`int32`, Default: `0`\]*** (全局环境下，接收端最大数目，0表示不做限制)
 - (Max number of receivers allowed globally. A value of zero disables limits)
 - ***`-global_sender_limit` \[`int32`, Default: `0`\]*** (全局环境下，发送端最大数目，0表示不做限制)
 - (Max number of senders allowed globally. A value of zero disables limits)
 - ***`-ignore_open_errors` \[`bool`, Default: `false`\]*** (忽略打开错误)
 - (will continue despite open errors)
 - ***`-include_regex` \[`string`, Default: `""`\]*** (表示哪些文件会被传送的正则表达式，空/默认值表示包含目录中的所有文件。如果同时设定了`exclude_regex`参数，符合`exclude_regex`的文件都会被排除而不被传输)
 - (Regular expression representing files to include for transfer empty/default is to include all files in directory. If exclude_regex is also specified, then files matching exclude_regex are excluded.)
 - ***`-ipv4` \[`bool`, Default: `false`\]*** (仅使用ipv4，优先于`-ipv6`选项)
 - (use ipv4 only, takes precedence over -ipv6)A
 - ***`-ipv6` \[`bool`, Default: `false`\]*** (倾向使用ipv6)
 - (prefers ipv6)
 - ***`-keep_transfer_log` \[`bool`, Default: `true`\]*** (若为`true`，则传送结束时，传送日志不被删除)
 - (If true, transfer logs are not deleted at the end of the transfer)
 - ***`-max_accept_retries` \[`int32`, Default: `500`\]*** (接收端的最大重联次数。发送端的首次连接请求必须在`max_accept_retries*accept_timeout_ms`毫秒的时间内到达。)
 - (max number of retries for accept call in receiver. First connection from sender must come before max_accept_retries * accept_timeout_ms milliseconds.)
 - ***`-max_mbytes_per_sec` \[`double`, Default: `0`\]*** (最大传输速率。负值表示不设上线，0表示自动配置。在自动配置模式下，极值速率为平均速率的1.2倍)
 - (Peak transfer rate in Mbytes/sec that should be maintained, specify negative for unlimited and 0 for auto configure. In auto configure mode peak rate will be 1.2 times average rate)
 - ***`-max_retries` \[`int32`, Default: `20`\]*** (连接/监听的最大尝试次数)
 - (how many attempts to connect/listen)
 - ***`-max_transfer_retries` \[`int32`, Default: `3`\]*** （发送端线程发送数据无进展情况下的最多重联次数）
 - (Maximum number of times sender thread reconnects without making any progress)
 - ***`-namespace_receiver_limit` \[`int32`, Default: `1`\]*** (每命名空间下接收端的最大数量，0表示取消限制)
 - (Max number of receivers allowed per namespace. A value of zero disables limits)
 - ***`-namespace_sender_limit` \[`int32`, Default: `0`\]*** (每命名空间下发送端的最大数量，0表示取消限制)
 - (Max number of senders allowed per namespace. A value of zero disables limits)
 - ***`-num_ports` \[`int32`, Default: `8`\]*** (套接字端口数量)
 - (Number of sockets)
 - ***`-odirect_reads` \[`bool`, Default: `false`\]*** (发送端是否使用`O_DIRECT`模式读取文件)
 - (Wdt can read files in O_DIRECT mode, set this flag to true to make sender read all files in O_DIRECT)
 - ***`-open_files_during_discovery` \[`int32`, Default: `0`\]*** (文件发现期间允许被打开文件的最大数量，0表示不允许发现期间打开，-1表示发现期间打开所有文件)
 - (If >0 up to that many files are opened when they are discovered.0 for none. -1 for trying to open all the files during discovery)
 - ***`-overwrite` \[`bool`, Default: `false`\]*** (是否允许接收端覆盖已存在的文件)
 - (Allow the receiver to overwrite existing files)
 - ***`-progress_report_interval_millis` \[`int32`, Default: `20`\]*** (进度报告间隔，若为0则不进行进度报告)
 - (Interval(ms) between progress reports. If the value is 0, no progress reporting is done)
 - ***`-prune_dir_regex` \[`string`, Default: `""`\]*** (被排除传送的目录正则表达式，即不传输符合该正则表达式目录)
 - (Regular expression representing directories to exclude for transfer, default/empty is to recurse in all directories)
 - ***`-read_timeout_millis` \[`int32`, Default: `5000`\]*** (套接字读的超时值，单位为毫秒)
 - (socket read timeout in milliseconds)
 - ***`-receive_buffer_size` \[`int32`, Default: `0`\]*** (接收端套接字接收缓冲区的大小，若`<=0`，则不设置缓冲区大小)
 - (Receive buffer size for receiver sockets. If <= 0, buffer size is not set)
 - ***`-resume_using_dir_tree` \[`bool`, Default: `false`\]*** (若为`true`，续传时根据目的目录树结构进行判定，仅剩余部分的文件需要进行传输。该参数进在取消`preallocation`以及`block mode`时才有效)
 - (If true, destination directory tree is trusted during resumption. So, only the remaining portion of the files are transferred. This is only supported if preallocation and block mode are disabled)
 - ***`-send_buffer_size` \[`int32`, Default: `0`\]*** (发送端套接字发送缓冲区的大小，若为`<=0`，则不设置缓冲区大小)
 - (Send buffer size for sender sockets. If <= 0, buffer size is not set)
 - ***`-skip_fadvise` \[`bool`, Default: `false`\]*** (若为`true`，数据块写结束后跳过`fadvise`)
 - (If true, fadvise is skipped after block write)
 - ***`-skip_writes` \[`bool`, Default: `false`\]*** (接收端跳过写)
 - (Skip writes on the receiver side)
 - ***`-sleep_millis` \[`int32`, Default: `50`\]*** (两次尝试之间的时间间隔，单位为毫秒)
 - (how many ms to wait between attempts)
 - ***`-start_port` \[`int32`, Default: `22356`\]*** (wdt监听的起始端口，若设置，则意味着`static_ports`为`true`)
 - (Starting port number for wdt, if set, implies static_ports)
 - ***`-static_ports` \[`bool`, Default: `false`\]*** (是否使用静态端口)
 - (Use static ports (start_port) or any free port)
 - ***`-throttler_bucket_limit` \[`double`, Default: `0`\]*** (用于控制可以不限制速率传送数据的数据量，单位为Mbytes。???)
 - (Limit of burst in Mbytes to control how much data you can send at unlimited speed. Unless you specify a peak rate of -1, wdt will either use your burst limit (if not 0) or max burst possible at a time will be 2 times the data allowed in 1/4th seconds at peak rate)
 - ***`-throttler_log_time_millis` \[`int64`, Default: `0`\]*** (Peak throttler会对传输瞬时速度打印。该值表示日志的记录时间间隔，单位为毫秒)
 - (Peak throttler prints out logs for instantaneous rate of transfer. Specify the time interval (ms) for the measure of instance)
 - ***`-throughput_update_interval_millis` \[`int32`, Default: `500`\]*** (当前吞吐量进度报告的时间间隔，单位为毫秒)
 - (Intervals in millis after which progress reporter updates current throughput)
 - ***`-transfer_log_write_interval_ms` \[`int32`, Default: `100`\]*** (传输日志写到磁盘中的时间间隔，单位为毫秒)
 - (Interval in milliseconds after which transfer log is written to disk. written to disk)
 - ***`-two_phases` \[`bool`, Default: `false`\]*** (是否开启两阶段目录发现???)
 - (do directory discovery first/separately)
 - ***`-write_timeout_millis` \[`int32`, Default: `5000`\]*** (套接字写的最大超时值，单位为毫秒)
 - (socket write timeout in milliseconds)

## 日志相关选项
  请使用 `wdt --help`查看相应部分。
