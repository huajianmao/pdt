# PDT 帮助文档

## 一、pDT使用案例

- 接收端： `pdt.exe -directory RECEIVE_DIR -transfer_id xxxxxxxx -run_as_daemon=true -ipv4`
  - `RECEIVE_DIR`表示接收端存放接收数据的目录。
  - `transfer_id`指定接收端的传输id。不使用该参数则pdt程序自动生成。
  - `run_as_daemon`设置为true，指定接收端以daemon模式运行，一直在线监听。
- 发送端： `pdt.exe -directory SEND_DATA_DIR -destination REVEIVER_IP -transfer_id xxxxxxxx`
  - `SEND_DATA_DIR`目录下包含一次测试需要传输的数据
  - `transfer_id`接收端指定的transfer_id参数，或接收端自动生成的transfer_id。


## 二、PDT命令行所支持的参数选项
本命令行参数选项主要来自于 `pdt --help`。其中，pdt的版本信息为：` PDT Warp-speed Data Transfer. v 1.26.1603040 p 26`。
PDT命令行选项主要包括pdtCmdLine.cpp、util/pdtFlags.cpp、util/pdtFlags.cpp.inc这三部分的选项。

### 2.1 pdtCmdLine.cpp部分
 - ***`-abort_after_seconds` \[`int32`, Default: `0`\]*** (给定时间后中止传输，0表示不中止)
 - ***`-app_name` \[`string`, Default: `pdt`\]*** (应用标识符,用于输出报告)
 - ***`-connection_url` \[`string`, Default: `""`\]*** (接收端生成的连接地址（包含`transfer_id`以及其他参数），使用ssh时不推荐使用本参数，可使用`-`命令行参数作为替换保证密钥传输的安全性)
 - ***`-destination` \[`string`, Default: `""`\]*** (为空表示服务端模式，非空时用于指定目标主机)
 - ***`-directory` \[`string`, Default: `""`\]*** (数据源/数据目标 目录)
 - ***`-exit_on_bad_flags` \[`bool`, Default: `true`\]*** (若为`true`，给定错误或未识别的flag时，pdt立即退出；若为false，pdt将会忽略未知的flags)
 - ***`-fork` \[`bool`, Default: `false`\]*** (若为`true`，pdt会生成一个receiver进程)
 - ***`-manifest` \[`string`, Default: `""`\]*** (用于发送端指定`manifest`文件，该文件中列出所有需要传送的文件，及文件大小（可选）；若值为`-`，表示从`stdin`读取文件列表信息；manifest文件每行代表一个待传输文件，每行最多两个以空格分隔的字段，第一个字段为文件名，第二字段代表文件大小（可选）)
 - ***`-parse_transfer_log` \[`bool`, Default: `false`\]*** (是否开启日志解析与修复功能)
 - ***`-print_options` \[`bool`, Default: `false`\]*** (若为`true`，则打印选项参数值并退出pdt。打印的选项值包括选项类型以及指定的其他命令行`flag`)
 - ***`-protocol_version` \[`int32`, Default: `0`\]*** (协议版本号，主要用于模拟协议协商)
 - ***`-recovery_id` \[`string`, Default: `""`\]*** (用于下载续传的恢复id号)
 - ***`-run_as_daemon` \[`bool`, Default: `false`\]*** (是否作为daemon程序运行，若为`true`，则receiver不会退出并一直运行)
 - ***`-test_only_encryption_secret` \[`string`, Default: `""`\]*** (仅用于测试，测试url编解码)
 - ***`-transfer_id` \[`string`, Default: `""`\]*** (传输`id`。如果不指定，接收端在启动时会自动产生一个传输`id`。发送端用该参数指定接收端的传输`id`。)
 - ***`-treat_fewer_port_as_error` \[`bool`, Default: `false`\]*** (当接收端无法绑定所有wdt所需端口时，是否将该情况作为错误处理。)

### 2.2 util/PdtFlags.cpp部分
 - ***`-option_type` \[`string`, Default: `flash`\]***（PDT选项类型。根据类型值初始化默认的参数值，后面执行过程中，每一个参数值还可以通过其他选项进行修改，通过-print_options查看参数值。）

### 2.3 util/PdtFlags.cpp.inc部分
 - ***`-abort_check_interval_millis` \[`int32`, Default: `200`\]*** (网络i/o期间检查是否中止的时间间隔，单位为毫秒。负值或0表示不作检查。)
 - ***`-accept_timeout_millis` \[`int32`, Default: `100`\]*** (pdt接收端接受请求的最大等待时延)
 - ***`-accept_window_millis` \[`int32`, Default: `2000`\]*** (接受时延窗口，单位为毫秒。对于一次会话，收到第一次连接后，其他连接必须要在接受时延窗口内到达)
 - ***`-avg_mbytes_per_sec` \[`double`, Default: `-1`\]*** (应该维持的目标传输速率，负值表示不设上限)
 - ***`-backlog` \[`int32`, Default: `1`\]*** （接受backlog）
 - ***`-block_size_mbytes` \[`double`, Default: `16`\]*** (文件传送数据块大小，负值表示文件传送时取消分块)
 - ***`-buffer_size` \[`int32`, Default: `262144`\]*** (每线程/套接字连接的缓存大小)
 - ***`-connect_timeout_millis` \[`int32`, Default: `1000`\]*** (套接字连接最大超时，单位为毫秒)
 - ***`-delete_extra_files` \[`bool`, Default: `false`\]*** (恢复数据传输时，删除接收端的额外文件)
 - ***`-disable_preallocation` \[`bool`, Default: `false`\]*** (取消通过`posix_fallocate`预分配文件)
 - ***`-disable_sender_verification_during_resumption` \[`bool`, Default: `false`\]*** (取消发送端ip与传送日志中ip的比较验证。当文件可以从不同主机下载时，该机制非常有用)
 - ***`-disk_sync_interval_mb` \[`double`, Default: `0.5`\]*** (磁盘同步间隔，单位为mb。负值表示取消同步)
 - ***`-drain_extra_ms` \[`int32`, Default: `500`\]*** (发送端等待接收端完成缓冲区数据处理的额外缓冲时间)
 - ***`-enable_checksum` \[`bool`, Default: `false`\]*** (若为`true`，数据传送时开启对数据块进行校验和校验)
 - ***`-enable_download_resumption` \[`bool`, Default: `false`\]*** (若为`true`，pdt则支持对`append-only`文件的下载续传)
 - ***`-enable_perf_stat_collection` \[`bool`, Default: `false`\]*** (若为`true`，pdt会在数据传输结束时收集并报告性能统计)
 - ***`-encryption_type` \[`string`, Default: `"aes128gcm"`\]*** (加密方式，PDT目前支持`aes128ctr`（最快但没有完整性校验）以及`aes128gcm`（推荐及默认方式）。若未设置该值，传输过程中数据不加密（速度最快但不安全）)
 - ***`-exclude_regex` \[`string`, Default: `""`\]*** (用正则表达式表示不需传输的文件，空/默认值表示不排除任何文件，即所有文件都会被传输。)
 - ***`-follow_symlinks` \[`bool`, Default: `false`\]*** (若为`true`，符号链接文件所指向的原文件被传输)
 - ***`-full_reporting` \[`bool`, Default: `false`\]*** (若为`true`，在传输报告中记录所有传输成功文件的传输状态)
 - ***`-global_receiver_limit` \[`int32`, Default: `0`\]*** (全局环境下，接收端最大数目，0表示不做限制)
 - ***`-global_sender_limit` \[`int32`, Default: `0`\]*** (全局环境下，发送端最大数目，0表示不做限制)
 - ***`-ignore_open_errors` \[`bool`, Default: `false`\]*** (忽略打开错误)
 - ***`-include_regex` \[`string`, Default: `""`\]*** (用正则表达式表示需要传输的文件，空/默认值表示传输目录中的所有文件。如果同时设定了`exclude_regex`参数，符合`exclude_regex`的文件都会被排除而不传输)
 - ***`-ipv4` \[`bool`, Default: `false`\]*** (仅使用ipv4，优先于`-ipv6`选项)
 - ***`-ipv6` \[`bool`, Default: `false`\]*** (倾向使用ipv6)
 - ***`-keep_transfer_log` \[`bool`, Default: `true`\]*** (若为`true`，则传送结束时，不删除传送日志)
 - ***`-max_accept_retries` \[`int32`, Default: `500`\]*** (接收端的最大重联次数。发送端的首次连接请求必须在`max_accept_retries*accept_timeout_ms`毫秒的时间内到达。)
 - ***`-max_mbytes_per_sec` \[`double`, Default: `0`\]*** (指定峰值传输速率。负值表示不设上限，0表示自动配置。在自动配置模式下，峰值速率为平均速率的1.2倍)
 - ***`-max_retries` \[`int32`, Default: `20`\]*** (连接/监听的最大尝试次数)
 - ***`-max_transfer_retries` \[`int32`, Default: `3`\]*** （发送端线程发送数据无进展情况下的最多重连次数）
 - ***`-namespace_receiver_limit` \[`int32`, Default: `1`\]*** (每命名空间下接收端的最大数量，0表示取消限制)
 - ***`-namespace_sender_limit` \[`int32`, Default: `0`\]*** (每命名空间下发送端的最大数量，0表示取消限制)
 - ***`-num_ports` \[`int32`, Default: `8`\]*** (套接字端口数量)
 - ***`-odirect_reads` \[`bool`, Default: `false`\]*** (发送端是否使用`O_DIRECT`模式读取文件)
 - ***`-open_files_during_discovery` \[`int32`, Default: `0`\]*** (文件发现期间允许被打开文件的最大数量，0表示不允许发现期间打开，-1表示发现期间打开所有文件)
 - ***`-overwrite` \[`bool`, Default: `false`\]*** (是否允许接收端覆盖已存在的文件)
 - ***`-progress_report_interval_millis` \[`int32`, Default: `20`\]*** (进度报告间隔，若为0则不进行进度报告)
 - ***`-prune_dir_regex` \[`string`, Default: `""`\]*** (用正则表达式表示被排除传输的目录，即不传输符合该正则表达式的目录)
 - ***`-read_timeout_millis` \[`int32`, Default: `5000`\]*** (套接字读的超时值，单位为毫秒)
 - ***`-receive_buffer_size` \[`int32`, Default: `0`\]*** (接收端套接字接收缓冲区的大小，若`<=0`，则不设置缓冲区大小)
 - ***`-resume_using_dir_tree` \[`bool`, Default: `false`\]*** (若为`true`，续传时接收端目录树有效，仅传输剩余部分文件。该参数在取消`preallocation`以及`block mode`时才有效)
 - ***`-send_buffer_size` \[`int32`, Default: `0`\]*** (发送端套接字发送缓冲区的大小，若为`<=0`，则不设置缓冲区大小)
 - ***`-skip_fadvise` \[`bool`, Default: `false`\]*** (若为`true`，数据块写结束后跳过`fadvise`)
 - ***`-skip_writes` \[`bool`, Default: `false`\]*** (接收端跳过写)
 - ***`-sleep_millis` \[`int32`, Default: `50`\]*** (两次尝试之间的时间间隔，单位为毫秒)
 - ***`-start_port` \[`int32`, Default: `22356`\]*** (pdt监听的起始端口，若设置，则意味着`static_ports`为`true`)
 - ***`-static_ports` \[`bool`, Default: `false`\]*** (若为`true`表示使用静态端口，否则使用任意空闲端口)
 - ***`-throttler_bucket_limit` \[`double`, Default: `0`\]*** (指定用于控制无带宽限制网络条件下burst传输的数据量极值，单位为Mbytes。除非设置峰值速度为-1，否则，pdt使用设定的burst限制极值，或使用峰值速度下1/4秒传输数据量的2倍作为一次burst的数据传输极限。)
 - ***`-throttler_log_time_millis` \[`int64`, Default: `0`\]*** (Peak throttler在日志中记录传输的瞬时速度。该参数指定日志记录瞬时速度的时间间隔，单位为毫秒)
 - ***`-throughput_update_interval_millis` \[`int32`, Default: `500`\]*** (在进度报告中更新瞬时吞吐率的时间间隔，单位为毫秒)
 - ***`-transfer_log_write_interval_ms` \[`int32`, Default: `100`\]*** (指定将传输日志写入磁盘的时间间隔，单位为毫秒)
 - ***`-two_phases` \[`bool`, Default: `false`\]*** (指定是否独立监测目录。若为`true`，先检测目录后传输；否则，检测目录与传输分别进行。)
 - ***`-write_timeout_millis` \[`int32`, Default: `5000`\]*** (套接字写的最大超时值，单位为毫秒)

### 2.4 日志相关选项
  请使用 `wdt --help`查看相应部分。
