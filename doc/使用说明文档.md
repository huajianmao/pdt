# WDT 帮助文档


## WDT命令行所支持的参数选项
wdt: WDT Warp-speed Data Transfer. v 1.26.1603040 p 26.

### Example
 - **使用场景**：将数据从`srchost`的`srcdir`目录传送到`dsthost`的`dstdir`目录
 - **使用命令**：`ssh dsthost wdt -directory destdir | ssh srchost wdt -directory srcdir -`
 - **参数解释**：该命令首先在目的机器`dsthost`启动以`destdir`为目标目录的接收端，之后将receiver端启动产生的`connection_url`，通过ssh在发送端`srchost`启动以`srcdir`为数据源目录的`wdt`进程接收来自`connection_url`（命令中的`-`）的数据，从而实现数据从`srchost`到`dsthost`的传送。

### WDT命令行选项
#### wdtCmdLine.cpp部分
 - ***`-abort_after_seconds` \[`int32`, Default: `0`\]*** (给定时间后退出传送，0表示不退出)
 - (Abort transfer after given seconds. 0 means don't abort.)
 - ***`-app_name` \[`string`, Default: `wdt`\]*** (应用运行标识)
 - (Identifier used for reporting (scuba, at fb))
 - ***`-connection_url` \[`string`, Default: `""`\]*** (接收端生成的连接地址（包含`transfer_id`以及其他参数），使用ssh时不推荐使用本参数，可使用`-`命令行参数作为替换保证密钥传输的安全性)
 - (Provide the connection string to connect to receiver (incl. transfer_id and other parameters). Deprecated: use - arg instead for safe encryption key transmission)
 - ***`-destination` \[`string`, Default: `""`\]*** (为空表示服务端模式，非空时用于指定目标主机)
 - (empty is server (destination) mode, non empty is destination host)
 - ***`-directory` \[`string`, Default: `""`\]*** (数据源/数据目的 目录)
 - (Source/Destination directory)
 - ***`-exit_on_bad_flags` \[`bool`, Default: `true`\]*** (若为`true`，给定错误或未识别的flag时，wdt立即退出；若为false，wdt将会忽略未知的flags)
 - (If true, wdt exits on bad/unknown flag. Otherwise, an unknown flags are ignored)
 - ***`-fork` \[`bool`, Default: `false`\]*** (若为`true`，wdt会生成一个receiver进程)
 - (If true, forks the receiver, if false, no forking/stay in fg)
 - ***`-manifest` \[`string`, Default: `""`\]*** (用于发送端，当指定`manifest`文件时，该文件中列出所有需要传送的文件，及文件大小（可选）；若值为`-`，表示从`stdin`读取文件列表信息；manifest每行代表一个待传送文件，每行最多两个以空格分隔的字段，第一个字段为文件名，第二字段代表文件大小（可选）)
 - (If specified, then we will read a list of files and optional sizes from this file, use - for stdin)
 - ***`-parse_transfer_log` \[`bool`, Default: `false`\]*** (是否开启日志解析与修复功能)
 - (If true, transfer log is parsed and fixed)
 - ***`-print_options` \[`bool`, Default: `false`\]*** (若为`true`，则打印选项参数值并退出wdt。其中打印的选项值包括wdt自身以及其他一些给定的命令行`flag`)
 - (If true, wdt prints the option values and exits. Option values printed take into account option type and other command line flags specified.)
 - ***`-protocol_version` \[`int32`, Default: `0`\]*** (协议版本号，主要用于模拟协议协商)
 - (Protocol version to use, this is used to simulate protocol negotiation)
 - ***`-recovery_id` \[`string`, Default: `""`\]*** (用于下载续传的恢复id号)
 - (Recovery-id to use for download resumption)
 - ***`-run_as_daemon` \[`bool`, Default: `false`\]*** (是否作为daemon程序运行，若为`true`，则receiver不会退出并一直运行)
 - (If true, run the receiver as never ending process)
 - ***`-test_only_encryption_secret` \[`string`, Default: `""`\]*** (仅用于测试，测试url编解码???)
 - (Test only encryption secret, to test url encoding/decoding)
 - ***`-transfer_id` \[`string`, Default: `""`\]*** (传输`id`号，数据接收端在启动时会长生一个传输`id`号，用于接收端发送数据时指定传输目标`id`)
 - (Transfer id. Receiver will generate one to be used (via URL) on the sender if not set explicitly)
 - ***`-treat_fewer_port_as_error` \[`bool`, Default: `false`\]*** (当接收端无法绑定所有wdt所需端口时，是否将该情况作为错误处理而终止`wdt`程序)
 - (If the receiver is unable to bind to all the ports, treat that as an error.)

#### util/WdtFlags.cpp.inc部分

#### util/WdtFlags.cpp部分
 - ***`-option_type` \[`string`, Default: `flash`\]***
 - (WDT option type. Options are initialized to different values depending on the type. Individual options can still be changed using specific flags. Use -print_options to see values)

 - ***`-abort_check_interval_millis` \[`int32`, Default: `200`\]***
 - (Interval in ms between checking for abort during network i/o, a negative value or 0 disables abort check)
 - ***`-accept_timeout_millis` \[`int32`, Default: `100`\]***
 - (accept timeout for wdt receiver in milliseconds)
 - ***`-accept_window_millis` \[`int32`, Default: `2000`\]***
 - (accept window size in milliseconds. For a session, after the first connection is received, other connections must be received within this duration)
 - ***`-avg_mbytes_per_sec` \[`double`, Default: `-1`\]***
 - (Target transfer rate in Mbytes/sec that should be maintained, specify negative for unlimited)
 - ***`-backlog` \[`int32`, Default: `1`\]***
 - (Accept backlog)
 - ***`-block_size_mbytes` \[`double`, Default: `16`\]***
 - (Size of the blocks that files will be divided in, specify negative to disable the file splitting mode)
 - ***`-buffer_size` \[`int32`, Default: `262144`\]***
 - (Buffer size (per thread/socket))
 - ***`-connect_timeout_millis` \[`int32`, Default: `1000`\]***
 - (socket connect timeout in milliseconds)
 - ***`-delete_extra_files` \[`bool`, Default: `false`\]***
 - (If true, extra files on the receiver side is deleted during resumption)
 - ***`-disable_preallocation` \[`bool`, Default: `false`\]***
 - (If true, files are not pre-allocated using posix_fallocate)
 - ***`-disable_sender_verification_during_resumption` \[`bool`, Default: `false`\]***
 - (If true, sender-ip is not verified with the ip in transfer log. This is useful if files can be downloaded from different hosts)
 - ***`-disk_sync_interval_mb` \[`double`, Default: `0.5`\]***
 - (Disk sync interval in mb. A negative value disables syncing)
 - ***`-drain_extra_ms` \[`int32`, Default: `500`\]***
 - (Extra time buffer to account for network when sender waits for receiver to finish processing buffered data)
 - ***`-enable_checksum` \[`bool`, Default: `false`\]***
 - (If true, blocks are checksummed during transfer, redundant with gcm)
 - ***`-enable_download_resumption` \[`bool`, Default: `false`\]***
 - (If true, wdt supports download resumption for append-only files)
 - ***`-enable_perf_stat_collection` \[`bool`, Default: `false`\]***
 - (If true, perf stats are collected and reported at the end of transfer)
 - ***`-encryption_type` \[`string`, Default: `"aes128gcm"`\]***
 - (Encryption type to use. WDT currently supports aes128ctr (fastest but no integrity check) and aes128gcm (recommended, default). A value of none disables encryption (fastest but insecure))
 - ***`-exclude_regex` \[`string`, Default: `""`\]***
 - (Regular expression representing files to exclude for transfer, empty/default is to not exclude any file.)
 - ***`-follow_symlinks` \[`bool`, Default: `false`\]***
 - (If true, follow symlinks and copy them as well)
 - ***`-full_reporting` \[`bool`, Default: `false`\]***
 - (If true, transfer stats for successfully transferred files are included in the report)
 - ***`-global_receiver_limit` \[`int32`, Default: `0`\]***
 - (Max number of receivers allowed globally. A value of zero disables limits)
 - ***`-global_sender_limit` \[`int32`, Default: `0`\]***
 - (Max number of senders allowed globally. A value of zero disables limits)
 - ***`-ignore_open_errors` \[`bool`, Default: `false`\]***
 - (will continue despite open errors)
 - ***`-include_regex` \[`string`, Default: `""`\]***
 - (Regular expression representing files to include for transfer empty/default is to include all files in directory. If exclude_regex is also specified, then files matching exclude_regex are excluded.)
 - ***`-ipv4` \[`bool`, Default: `false`\]***
 - (use ipv4 only, takes precedence over -ipv6)
 - ***`-ipv6` \[`bool`, Default: `false`\]***
 - (prefers ipv6)
 - ***`-keep_transfer_log` \[`bool`, Default: `true`\]***
 - (If true, transfer logs are not deleted at the end of the transfer)
 - ***`-max_accept_retries` \[`int32`, Default: `500`\]***
 - (max number of retries for accept call in receiver. First connection from sender must come before max_accept_retries * accept_timeout_ms milliseconds.)
 - ***`-max_mbytes_per_sec` \[`double`, Default: `0`\]***
 - (Peak transfer rate in Mbytes/sec that should be maintained, specify negative for unlimited and 0 for auto configure. In auto configure mode peak rate will be 1.2 times average rate)
 - ***`-max_retries` \[`int32`, Default: `20`\]***
 - (how many attempts to connect/listen)
 - ***`-max_transfer_retries` \[`int32`, Default: `3`\]***
 - (Maximum number of times sender thread reconnects without making any progress)
 - ***`-namespace_receiver_limit` \[`int32`, Default: `1`\]***
 - (Max number of receivers allowed per namespace. A value of zero disables limits)
 - ***`-namespace_sender_limit` \[`int32`, Default: `0`\]***
 - (Max number of senders allowed per namespace. A value of zero disables limits)
 - ***`-num_ports` \[`int32`, Default: `8`\]***
 - (Number of sockets)
 - ***`-odirect_reads` \[`bool`, Default: `false`\]*** 
 - (Wdt can read files in O_DIRECT mode, set this flag to true to make sender read all files in O_DIRECT)
 - ***`-open_files_during_discovery` \[`int32`, Default: `0`\]***
 - (If >0 up to that many files are opened when they are discovered.0 for none. -1 for trying to open all the files during discovery)
 - ***`-overwrite` \[`bool`, Default: `false`\]***
 - (Allow the receiver to overwrite existing files)
 - ***`-progress_report_interval_millis` \[`int32`, Default: `20`\]***
 - (Interval(ms) between progress reports. If the value is 0, no progress reporting is done)
 - ***`-prune_dir_regex` \[`string`, Default: `""`\]***
 - (Regular expression representing directories to exclude for transfer, default/empty is to recurse in all directories)
 - ***`-read_timeout_millis` \[`int32`, Default: `5000`\]***
 - (socket read timeout in milliseconds)
 - ***`-receive_buffer_size` \[`int32`, Default: `0`\]***
 - (Receive buffer size for receiver sockets. If <= 0, buffer size is not set)
 - ***`-resume_using_dir_tree` \[`bool`, Default: `false`\]***
 - (If true, destination directory tree is trusted during resumption. So, only the remaining portion of the files are transferred. This is only supported if preallocation and block mode are disabled)
 - ***`-send_buffer_size` \[`int32`, Default: `0`\]***
 - (Send buffer size for sender sockets. If <= 0, buffer size is not set)
 - ***`-skip_fadvise` \[`bool`, Default: `false`\]***
 - (If true, fadvise is skipped after block write)
 - ***`-skip_writes` \[`bool`, Default: `false`\]***
 - (Skip writes on the receiver side)
 - ***`-sleep_millis` \[`int32`, Default: `50`\]***
 - (how many ms to wait between attempts)
 - ***`-start_port` \[`int32`, Default: `22356`\]***
 - (Starting port number for wdt, if set, implies static_ports)
 - ***`-static_ports` \[`bool`, Default: `false`\]***
 - (Use static ports (start_port) or any free port)
 - ***`-throttler_bucket_limit` \[`double`, Default: `0`\]***
 - (Limit of burst in Mbytes to control how much data you can send at unlimited speed. Unless you specify a peak rate of -1, wdt will either use your burst limit (if not 0) or max burst possible at a time will be 2 times the data allowed in 1/4th seconds at peak rate)
 - ***`-throttler_log_time_millis` \[`int64`, Default: `0`\]***
 - (Peak throttler prints out logs for instantaneous rate of transfer. Specify the time interval (ms) for the measure of instance)
 - ***`-throughput_update_interval_millis` \[`int32`, Default: `500`\]***
 - (Intervals in millis after which progress reporter updates current throughput)
 - ***`-transfer_log_write_interval_ms` \[`int32`, Default: `100`\]***
 - (Interval in milliseconds after which transfer log is written to disk. written to disk)
 - ***`-two_phases` \[`bool`, Default: `false`\]***
 - (do directory discovery first/separately)
 - ***`-write_timeout_millis` \[`int32`, Default: `5000`\]***
 - (socket write timeout in milliseconds)



``` log
  Flags from /home/hjmao/workspace/pdt/src/gflags/src/gflags.cc:
    -flagfile (load flags from file) type: string default: ""
    -fromenv (set flags from the environment [use 'export FLAGS_flag1=value'])
      type: string default: ""
    -tryfromenv (set flags from the environment if present) type: string
      default: ""
    -undefok (comma-separated list of flag names that it is okay to specify on
      the command line even if the program does not define a flag with that
      name.  IMPORTANT: flags in this list that have arguments MUST use the
      flag=value format) type: string default: ""

  Flags from /home/hjmao/workspace/pdt/src/gflags/src/gflags_completions.cc:
    -tab_completion_columns (Number of columns to use in output for tab
      completion) type: int32 default: 80
    -tab_completion_word (If non-empty, HandleCommandLineCompletions() will
      hijack the process and attempt to do bash-style command line flag
      completion on this value.) type: string default: ""

  Flags from /home/hjmao/workspace/pdt/src/gflags/src/gflags_reporting.cc:
    -help (show help on all flags [tip: all flags can have two dashes])
      type: bool default: false currently: true
    -helpfull (show help on all flags -- same as -help) type: bool
      default: false
    -helpmatch (show help on modules whose name contains the specified substr)
      type: string default: ""
    -helpon (show help on the modules named by this flag value) type: string
      default: ""
    -helppackage (show help on all modules in the main package) type: bool
      default: false
    -helpshort (show help on only the main module for this program) type: bool
      default: false
    -helpxml (produce an xml version of help) type: bool default: false
    -version (show version and build info and exit) type: bool default: false



  Flags from /home/hjmao/workspace/pdt/src/glog/src/logging.cc:
    -alsologtoemail (log messages go to these email addresses in addition to
      logfiles) type: string default: ""
    -alsologtostderr (log messages go to stderr in addition to logfiles)
      type: bool default: false
    -colorlogtostderr (color messages logged to stderr (if supported by
      terminal)) type: bool default: false
    -drop_log_memory (Drop in-memory buffers of log contents. Logs can grow
      very quickly and they are rarely read before they need to be evicted from
      memory. Instead, drop them from memory as soon as they are flushed to
      disk.) type: bool default: true
    -log_backtrace_at (Emit a backtrace when logging at file:linenum.)
      type: string default: ""
    -log_dir (If specified, logfiles are written into this directory instead of
      the default logging directory.) type: string default: ""
    -log_link (Put additional links to the log files in this directory)
      type: string default: ""
    -log_prefix (Prepend the log prefix to the start of each log line)
      type: bool default: true
    -logbuflevel (Buffer log messages logged at this level or lower (-1 means
      don't buffer; 0 means buffer INFO only; ...)) type: int32 default: 0
    -logbufsecs (Buffer log messages for at most this many seconds) type: int32
      default: 30
    -logemaillevel (Email log messages logged at this level or higher (0 means
      email all; 3 means email FATAL only; ...)) type: int32 default: 999
    -logfile_mode (Log file mode/permissions.) type: int32 default: 436
    -logmailer (Mailer used to send logging email) type: string
      default: "/bin/mail"
    -logtostderr (log messages go to stderr instead of logfiles) type: bool
      default: false currently: true
    -max_log_size (approx. maximum log file size (in MB). A value of 0 will be
      silently overridden to 1.) type: int32 default: 1800
    -minloglevel (Messages logged at a lower level than this don't actually get
      logged anywhere) type: int32 default: 0
    -stderrthreshold (log messages at or above this level are copied to stderr
      in addition to logfiles.  This flag obsoletes --alsologtostderr.)
      type: int32 default: 2
    -stop_logging_if_full_disk (Stop attempting to log to disk if the disk is
      full.) type: bool default: false

  Flags from /home/hjmao/workspace/pdt/src/glog/src/utilities.cc:
    -symbolize_stacktrace (Symbolize the stack trace in the tombstone)
      type: bool default: true

  Flags from /home/hjmao/workspace/pdt/src/glog/src/vlog_is_on.cc:
    -v (Show all VLOG(m) messages for m <= this. Overridable by --vmodule.)
      type: int32 default: 0
    -vmodule (per-module verbose level. Argument is a comma-separated list of
      <module name>=<log level>. <module name> is a glob pattern, matched
      against the filename base (that is, name ignoring .cc/.h./-inl.h). <log
      level> overrides any value given by --v.) type: string default: ""


```
